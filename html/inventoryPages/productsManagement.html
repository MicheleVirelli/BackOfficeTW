<!DOCTYPE html>
<html lang="it">

<head>
    <title>ThePrivilege employee stuff</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!--Stylesheet -->
    <link rel="stylesheet" href="../../css/style.css">

    <!-- Awesome CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    </script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Richiesta Api dal backend -->
    <script src="https://site202120.tw.cs.unibo.it/assets/config.js"></script>
    <script src="https://site202120.tw.cs.unibo.it/assets/api.js"></script>

    <!-- Funzioni di supporto -->
    <script src="../../js/function.js"></script>

    <script>
        $.get('../templates/authNav.html', (data) => {
            $('body').append(data)
        })
    </script>

    <script>
        async function checkToken() {
            const logged = await config.loggedIn()
            if (logged == false)
                document.location.href = "../../nauthHome.html"
        }
        checkToken()
    </script>

</head>

<body>
    <div id="content">
        <!-- Ci sono due casi, voglio aggiungere una post o una unit -->
        <div class="card p-5" style="background-color:#B2A8B9;">
            <!-- Campi della unit: nome -> quello del prodotto, prezzo, condizione [perfect, minor flaw, major flow, broken] -->
            <!-- Campi del rental: customer, employee, state, prenotationDate, bill, startDate, expectedEndDate, actualEndDate, unit, id, priceEstimation -->
            <!-- Campi della bill: customer, employee, basePrice, modifier, finalPrice, startRent, endRent, unit -->
            <!-- Campi della priceEstimation:  -->

            <!-- Creo una o più unit per un prodotto -->
            <form>
                <div class="input-group mb-3">
                    <span class="input-group-text">Prodotto:</span>
                    <select class="form-select" id="inputproduct">
                        <option value="undefined">Scegli il prodotto a cui aggiungere le unità</option>
                    </select> 
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">Prezzo:</span>
                    <span class="input-group-text">$</span>
                    <input id="inputprice" type="text" class="form-control" placeholder="Inserisci il prezzo della specifica unit">
                    <span class="input-group-text">.00</span>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">Condizione:</span>
                    <select class="form-select" id="inputcondition">
                        <option value="perfect">Perfetto</option>
                        <option value="minor flaw">Leggermente rovianto</option>
                        <option value="major flaw">Abbastanza rovinato</option>
                        <option value="broken">Rotto</option>
                    </select>
                  </div>
                <button id="submitunit" type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>


    </div>

    <!-- <div id="content">
        <h2>Page for the management of the products</h2>
        <button id="searchP">Search products</button><br><br>
        <button id="addP">Add a product</button>

        <div id="showPanel"></div>

    </div> -->

</body>
<footer>
    <script>
        $(document).ready(async () => {
            let query = { limit: 0 }
            const products = (await api.products.get(query)).data.docs
            console.log(products)

            products.forEach(product => {
                $('#inputproduct').append(`
                    <option value="${product._id}">${product.name}</option>
                `)
            })
            
        })

        $('#submitunit').on('click', async (event) => {
            event.preventDefault()
            let unit = {
                name: $('#inputproduct').text(),
                condition: $('#inputcondition').val(),
                price: $('#inputprice').val(),
                product: $('#inputproduct').val(),
                rentals: []
            }
            console.log(unit)
            
            const response = await api.units.post(unit, unit.product)
            console.log(response)
            
        })
    </script>

    <!-- <script>
        
        Io voglio che li aggiorni ogni volta che inserisco un carattere
        $('#searchP').click(() => {
            $('#showPanel').children('div').remove()

            //Mostra una searchBar nello show panel
            $('#showPanel').append(`
            <div>
            <form id="searchProduct">
                <input class="form-control me-2" type="search" placeholder="Search Products by name" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
            <div id="searchPanel"></div>
            </div>
            `)

            $('#searchProduct').on('submit', async (event) => {
                event.preventDefault()
                //Rimuove le ricerche precedenti
                $('#searchPanel').children('div').remove()

                let query = { name: $('#searchProduct').children('input').val() }

                const data = (await api.products.get(query)).data.docs

                data.forEach(async element => {

                    $('#searchPanel').append(`
                    <div class="card">
                        <h3>${element.name}</h3><br>
                        <h5>${element.category}, ${element.subcategory}</h5><br>
                        <p>${element.description}</p><br>
                        <p>${element.tags}</p><br>
                        <br><br>
                        
                    </div>
                    `)

                });

            })
        })

        function getCreateFormData() {
            let data = {
                name: $('#createForm').children('#name').val(),
                description: $('#createForm').children('#description').val(),
                category: $('#createForm').children('#category').val(),
                subcategory: $('#createForm').children('#subcategory').val(),
                //TODO: pensare alla gestione di IMAGE TAGS ed gli ALTPRODUCTS
                tags: $('#createForm').children('#tag').val() || [],
                altproducts: $('#createForm').children('#altproducts').val() || [],
            }
            return data
        }

        Spazio per fare la post di un prodotto
        $('#addP').click(() => {
            $('#showPanel').children('div').remove()

            //Mostra una searchBar nello show panel
            $('#showPanel').append(`
            <div>
            <form id="createForm">
                <label for="name">Product Name: </label><br>
                <input id="name" type="text"><br>
                <label for="description">Product Description: </label><br>
                <textarea id="description" rows="2" cols="25"></textarea><br>
                <label for="image">Product Image: </label><br>
                <input id="image" type="file"><br>
                <label for="category">Products Category: </label><br>
                <input id="category" type="text"><br>
                <label for="subcategory">Products Subcategory: </label><br>
                <input id="subcategory" type="text"><br>
                <label for="tags">Products Tag: </label><br>
                <input id="tags" disabled="disabled" type="text"><br>
                <label for="altproducts">Alternative to the Products: </label><br>
                <input id="altproducts" disabled="disabled" type="text"><br>
            

                <button type="submit"> Create Products</button>
            </form>
            <div>
            `)

            $("#createForm").on("submit", async function (event) {
                event.preventDefault()
                let product = getCreateFormData()
                console.log(product)

                //Ora devo fare una post !!
                const response = await api.products.post(product)
                console.log(response)
            });

        })

    </script> -->
</footer>

</html>