<!DOCTYPE html>
<html lang="it">

<head>
    <title>ThePrivilege employee stuff</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!--Stylesheet -->
    <link rel="stylesheet" href="../../css/style.css">

    <!-- Awesome CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    </script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Richiesta Api dal backend -->
    <script src="https://site202120.tw.cs.unibo.it/assets/config.js"></script>
    <script src="https://site202120.tw.cs.unibo.it/assets/api.js"></script>

    <!-- Funzioni di supporto -->
    <script src="../../js/function.js"></script>

    <script>
        $.get('../templates/authNav.html', (data) => {
            $('body').append(data)
        })
    </script>

    <script>
        checkToken()
    </script>

</head>

<body>
    <div id="content">
        <div id="basicinfo" class="row mb-4"></div>

        <div id="unitinfo" class="row mb-4">
            <div class="card mb-3 p-3">
                <table class="table table-hover" id="unitpart">
                    <tr>
                        <td>Unit</td>
                        <td>Price</td>
                        <td>Stato</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="mb-4">
            <div class="card mb-3 row">
                <div class="container-fluid row p-0 m-0" id="altproductsinfo">
                </div>
            </div>
        </div>

        <div id="rentinfo" class="row mb-4"></div>
    </div>
</body>

<footer>
    <script>
        const idProduct = localStorage.getItem("idProduct");

        $(document).ready(async function () {
            let query = {
                populate: true
            }

            const product = (await api.products.getSingle(idProduct, query)).data
            console.log(product)

            const units = (await api.units.get()).data
            console.log(units)
            

            //TODO: Risolvere il problema delle chiamate multiple
            // let altproducts
            // product.altproducts.forEach(idAltProducts => {
            //     console.log(idAltProducts)
            //     altproducts = (await api.products.getSingle(idAltProducts)).data
            //     console.log(altproducts)
            // });

            //Informazioni base sul prodotto
            $('#basicinfo').append(`
            <div class="card">
                <div class="row g-0">
                    <div class="col-md-4  pt-4">
                        <img src="https://site202120.tw.cs.unibo.it/${product.image}" class="img-fluid rounded-start" alt="...">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">${product.name}</h5>
                            <p class="card-text">${product.category}, ${product.subcategory}</p>
                            <p class="card-text">${product.description}</p>
                            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                        </div>
                    </div>
                </div>
            </div>
            `)

            //Informazioni sulle unità legate al prodotto

            let i = 0
            units.forEach(unit => {
                i++
                $('#unitpart').append(`
                    <tr>
                        <td>Unit n°${i}</td>
                        <td>${unit.price}</td>
                        <td>${unit.condition}</td>
                    </tr>
                `)
            });

            //Informazioni sui prodotti alternativi
            // $('#altproductsinfo').append(`
            // <div class="card mb-3 row" style="background-color:#B2A8B9;">

            // </div>
            // `)
                let rental = {boh: 'placeholder', unit: 'placeholder'}
            $('#altproductinfo').append(`
                <div class="card col-sm-4">
                    <img src="https://site202120.tw.cs.unibo.it/${rental.boh}" class="card-img-top">
                    <div class="card-body">
                        <h5 class="card-title">${rental.unit}/h5>
                        <p class="card-text">${rental.boh}</p>
                    </div>
                </div>
            `)

            //Informazioni sui rent
            $('#rentinfo').append(`
            <div class="card mb-3">
                <p>Funzioni al momento non disponibili</p>
            </div>
            `)

            //TODO: Sarebbe bello vedere i kit legati al prodotto ...

        })
    </script>
</footer>

</html>